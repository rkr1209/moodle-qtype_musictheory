YUI.add("moodle-qtype_musictheory-musictheoryqtype",function(e,t){M.qtype_musictheory=M.qtype_musictheory||{},M.qtype_musictheory.musictheoryqtype={};var n=M.qtype_musictheory.musictheoryqtype;n.questionRender={},n.initQuestionRender=function(e){var t=e.inputname,o=e.optionsxml,i=e.readonly,s=e.initialinput,a=e.correctresponse,r=e.correctrespstr,l=e.additionalparams,c=n.questionRender.convertOptionsXMLtoObjectLiteral(o,l);n.questionRender.renderQuestion(t,c,i,s),null!=a&&""!==a&&n.questionRender.renderCorrectResponse(t,c,a,r)},n.questionRender.renderQuestion=function(t,o,i,s){var a,r,l,c,u,g,m,f;t=t.replace(":","\\:"),a=e.one("#"+t),(u=e.one("#musictheory_div_replacedbycanvas_"+t))&&u.hide(),(r=e.one("#musictheory_div_canvas_"+t))&&(l="musictheory_renderMusicCanvas_"+t.replace("\\:","-"),(g=e.one("#"+l))||(g=e.Node.create('<div style="margin-top:10px;margin-bottom:15px;overflow:auto"><canvas id="'+l+'" width="1" height="1" /></div>'),r.append(g)),o.editable=!i,o.containsUserInput=!0,f=function(e){a.set("value",c.getCanvasTextOutput(e))},m=(c=new n.XMLConverter(o)).getCanvasXML(s),"keyboard-input"===o.musicQType?new KeyboardInput(l,m,f):new MusThGUI(l,m,f),r.show())},n.questionRender.renderCorrectResponse=function(t,o,i,s){var a,r,l,c;t=t.replace(":","\\:"),(a=e.one("#musictheory_correctanswerdiv_"+t))&&(r="musictheory_renderCorrectResponseCanvas_"+t.replace("\\:","-"),e.one("#"+r)||a.setHTML("<p>"+s+'</p><canvas id="'+r+'" width="1" height="1" />'),o.editable=!1,o.containsUserInput=!1,c=function(){},l=new n.XMLConverter(o).getCanvasXML(i),"keyboard-input"===o.musicQType?new KeyboardInput(r,l,c):new MusThGUI(r,l,c))},n.questionRender.convertOptionsXMLtoObjectLiteral=function(t,n){var o={},i=e.XML.parse(t).getElementsByTagName("options")[0].firstChild,s=i.nodeName;switch(o.musicQType=s,s){case"note-write":case"note-identify":o.clef=i.getElementsByTagName("clef")[0].firstChild.nodeValue,o.includeAlterations=i.getElementsByTagName("includealterations")[0].firstChild.nodeValue,o.includeAlterations="true"===o.includeAlterations;break;case"keyboard-input":o.includestaticnote=i.getElementsByTagName("includestaticnote")[0].firstChild.nodeValue,"true"===o.includestaticnote&&(o.staticnotepitchclass=n.pitchclass,o.staticnoteregister=n.register);break;case"keysignature-write":case"keysignature-identify":o.clef=i.getElementsByTagName("clef")[0].firstChild.nodeValue,o.key=i.getElementsByTagName("key")[0].firstChild.nodeValue;break;case"interval-write":case"interval-identify":o.clef=i.getElementsByTagName("clef")[0].firstChild.nodeValue,o.givenNote=[],o.givenNote.ltr=i.getElementsByTagName("letter")[0].firstChild.nodeValue,o.givenNote.acc=i.getElementsByTagName("accidental")[0].firstChild.nodeValue,o.givenNote.reg=i.getElementsByTagName("register")[0].firstChild.nodeValue;break;case"scale-write":case"scale-identify":o.clef=i.getElementsByTagName("clef")[0].firstChild.nodeValue,o.givenNote=[],o.givenNote.ltr=i.getElementsByTagName("letter")[0].firstChild.nodeValue,o.givenNote.acc=i.getElementsByTagName("accidental")[0].firstChild.nodeValue,o.givenNote.reg=i.getElementsByTagName("register")[0].firstChild.nodeValue,o.includeKS=i.getElementsByTagName("displaykeysignature")[0].firstChild.nodeValue,o.includeKS="true"===o.includeKS,o.scaleType=i.getElementsByTagName("scaletype")[0].firstChild.nodeValue;break;case"chordquality-write":case"chordquality-identify":o.clef=i.getElementsByTagName("clef")[0].firstChild.nodeValue,o.maxNotes=n.maxnotes;break;case"harmonicfunction-write":o.maxNotes=n.maxnotes,o.clef=i.getElementsByTagName("clef")[0].firstChild.nodeValue,o.key=i.getElementsByTagName("key")[0].firstChild.nodeValue,o.includeKS=i.getElementsByTagName("displaykeysignature")[0].firstChild.nodeValue,o.includeKS="true"===o.includeKS;break;case"harmonicfunction-identify":o.clef=i.getElementsByTagName("clef")[0].firstChild.nodeValue,o.key=i.getElementsByTagName("key")[0].firstChild.nodeValue,o.includeKS=i.getElementsByTagName("displaykeysignature")[0].firstChild.nodeValue,o.includeKS="true"===o.includeKS}return o},n.editForm={},n.initEditForm=function(){n.editForm.setOptionVisibility(),n.editForm.setFormOptionListeners()},n.editForm.setFormOptionListeners=function(){e.all("#id_musictheory_musicqtype").on("change",function(){var t=e.one("#id_musictheory_updatemusicqtype");t&&t.simulate("click")})},n.editForm.setOptionVisibility=function(){var t=e.one("#id_musictheory_updatemusicqtype");t&&t.hide()},n.getKeySign=function(e,t){var n,o=e.substring(0,e.length-1),i=e.substr(e.length-1,1),s=new Array("F#5","C#5","G#5","D#5","A#4","E#5","B#4"),a=new Array("F#3","C#3","G#3","D#3","A#2","E#3","B#2"),r=new Array("F#4","C#4","G#4","D#4","A#3","E#4","B#3"),l=new Array("F#3","C#4","G#3","D#4","A#3","E#4","B#3"),c=new Array("Bb4","Eb5","Ab4","Db5","Gb4","Cb5","Fb4"),u=new Array("Bb2","Eb3","Ab2","Db3","Gb2","Cb3","Fb2"),g=new Array("Bb3","Eb4","Ab3","Db4","Gb3","Cb4","Fb3"),m=new Array("Bb3","Eb4","Ab3","Db4","Gb3","Cb4","Fb3"),f=[],y=[],d=[],h=[];return f.Cn="sharp",f.Gn="sharp",f.Dn="sharp",f.An="sharp",f.En="sharp",f.Bn="sharp",f["F#"]="sharp",f["C#"]="sharp",f.Fn="flat",f.Bb="flat",f.Eb="flat",f.Ab="flat",f.Db="flat",f.Gb="flat",f.Cb="flat",y.treblesharp=s,y.basssharp=a,y.altosharp=r,y.tenorsharp=l,y.trebleflat=c,y.bassflat=u,y.altoflat=g,y.tenorflat=m,d.Cn=0,d.Gn=1,d.Dn=2,d.An=3,d.En=4,d.Bn=5,d["F#"]=6,d["C#"]=7,d.Fn=1,d.Bb=2,d.Eb=3,d.Ab=4,d.Db=5,d.Gb=6,d.Cb=7,h.An="Cn",h.En="Gn",h.Bn="Dn",h["F#"]="An",h["C#"]="En",h["G#"]="Bn",h["D#"]="F#",h["A#"]="C#",h.Dn="Fn",h.Gn="Bb",h.Cn="Eb",h.Fn="Ab",h.Bb="Db",h.Eb="Gb",h.Ab="Cb",y[t+f[n="M"===i?o:h[o]]].slice(0,d[n])},n.XMLConverter=function(e){this.options=e,this.setNotesEditable=!!e.containsUserInput},n.XMLConverter.prototype.getCanvasXML=function(e){switch(this.options.musicQType){case"note-write":return this.getNoteWriteXML(e);case"note-identify":return this.getNoteIdentifyXML(e);case"keyboard-input":return this.getKeyboardInputXML(e);case"keysignature-write":return this.getKSWriteXML(e);case"keysignature-identify":return this.getKSIdentifyXML(e);case"interval-write":return this.getIntervalWriteXML(e);case"interval-identify":return this.getIntervalIdentifyXML(e);case"scale-write":return this.getScaleWriteXML(e);case"scale-identify":return this.getScaleIdentifyXML(e);case"chordquality-write":return this.getChordQualityWriteXML(e);case"harmonicfunction-write":return this.getHarmonicFunctionWriteXML(e);case"harmonicfunction-identify":case"chordquality-identify":return this.getHarmonicFunctionIdentifyXML(e);default:return null}},n.XMLConverter.prototype.getCanvasTextOutput=function(e){switch(this.options.musicQType){case"note-write":return this.getNoteWriteTextOutput(e);case"keyboard-input":return this.getKeyboardInputTextOutput(e);case"keysignature-write":return this.getKSWriteTextOutput(e);case"interval-write":return this.getIntervalWriteTextOutput(e);case"scale-write":return this.getScaleWriteTextOutput(e);case"chordquality-write":case"harmonicfunction-write":return this.getHarmonicfunctionWriteTextOutput(e);default:return""}return""},n.XMLConverter.prototype.getNoteWriteTextOutput=function(t){var n,o,i,s,a,r;for(o="",s=e.XML.parse(t).getElementsByTagName("Staff"),r=0;r<s.length;r++)for(i=s[r].getElementsByTagName("Note"),a=0;a<i.length;a++)"true"===i[a].getAttribute("editable")&&(n=i[a].getAttribute("accidental"),o+=i[a].getAttribute("letter")+n+i[a].getAttribute("register")+"-"+s[r].getAttribute("clef")+",");return o=o.length>0?o.substr(0,o.length-1):""},n.XMLConverter.prototype.getNoteWriteXML=function(e){var t,n,o,i,s=[],a=[];if(t='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',"grandstaff"!==this.options.clef)t+='<StaffSystem maxLedgerLines="4">\n',t+='<Staff clef="'+this.options.clef+'">\n',t+='<KeySign totalAccColumns="0" >',t+="</KeySign>",t+="<NoteColumns>",t+='<NoteColumn maxNotes="1" >',""!==e&&null!=e&&(t+='<Note letter="'+(n=this.noteNameToParts(e)).ltr+'" ',t+='register="'+n.reg+'" ',t+='accidental="'+n.acc+'" ',t+='noteValue="whole" editable="'+this.setNotesEditable+'" />'),t+="</NoteColumn>",t+="</NoteColumns>",t+="</Staff>\n",t+="</StaffSystem>\n";else{if(""!==e&&null!=e)for(o=e.split(","),i=0;i<o.length;i++)"treble"===(n=this.noteNameToParts(o[i])).clef?s.push(n):"bass"===n.clef?a.push(n):parseInt(n.reg,10)>=4?s.push(n):a.push(n);t+='<StaffSystem maxLedgerLines="4">\n',t+='<Staff clef="treble">\n',t+='<KeySign totalAccColumns="0" >',t+="</KeySign>",t+="<NoteColumns>",t+='<NoteColumn maxNotes="1" >',s.length>0&&(t+='<Note letter="'+s[0].ltr+'" ',t+='register="'+s[0].reg+'" ',t+='accidental="'+s[0].acc+'" ',t+='noteValue="whole" editable="'+this.setNotesEditable+'" />'),t+="</NoteColumn>",t+="</NoteColumns>",t+="</Staff>\n",t+='<Staff clef="bass">\n',t+='<KeySign totalAccColumns="0" >',t+="</KeySign>",t+="<NoteColumns>",t+='<NoteColumn maxNotes="1" >',a.length>0&&(t+='<Note letter="'+a[0].ltr+'" ',t+='register="'+a[0].reg+'" ',t+='accidental="'+a[0].acc+'" ',t+='noteValue="whole" editable="'+this.setNotesEditable+'" />'),t+="</NoteColumn>",t+="</NoteColumns>",t+="</Staff>\n",t+="</StaffSystem>\n"}return this.options.includeAlterations&&(t+="    <Toolbars>\n",t+="        <AccidentalToolbar>\n",t+='            <Button symbol="n"/>',t+='            <Button symbol="#"/>',t+='            <Button symbol="b"/>',t+='            <Button symbol="x"/>',t+='            <Button symbol="bb"/>',t+="        </AccidentalToolbar>\n",t+="    </Toolbars>\n"),t+="</MusThGUI>"},n.XMLConverter.prototype.getNoteIdentifyXML=function(e){var t,n;return n=this.noteNameToParts(e),"grandstaff"!==this.options.clef?(t='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',t+='<StaffSystem maxLedgerLines="4">\n',t+='<Staff clef="'+this.options.clef+'">\n',t+='<KeySign totalAccColumns="0" >',t+="</KeySign>",t+="<NoteColumns>",t+='<NoteColumn maxNotes="1" >',t+='<Note letter="'+(n=this.noteNameToParts(e)).ltr+'" ',t+='register="'+n.reg+'" ',t+='accidental="'+n.acc+'" ',t+='noteValue="whole" editable="false" />',t+="</NoteColumn>",t+="</NoteColumns>",t+="</Staff>\n",t+="</StaffSystem>\n",t+="</MusThGUI>"):(t='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',t+='<StaffSystem maxLedgerLines="4">\n',t+='<Staff clef="treble">\n',t+='<KeySign totalAccColumns="0" >',t+="</KeySign>",t+="<NoteColumns>",t+='<NoteColumn maxNotes="1" >',parseInt(n.reg,10)>=4&&(t+='<Note letter="'+n.ltr+'" ',t+='register="'+n.reg+'" ',t+='accidental="'+n.acc+'" ',t+='noteValue="whole" editable="false" />'),t+="</NoteColumn>",t+="</NoteColumns>",t+="</Staff>\n",t+='<Staff clef="bass">\n',t+='<KeySign totalAccColumns="0" >',t+="</KeySign>",t+="<NoteColumns>",t+='<NoteColumn maxNotes="1" >',parseInt(n.reg,10)<4&&(t+='<Note letter="'+n.ltr+'" ',t+='register="'+n.reg+'" ',t+='accidental="'+n.acc+'" ',t+='noteValue="whole" editable="false" />'),t+="</NoteColumn>",t+="</NoteColumns>",t+="</Staff>\n",t+="</StaffSystem>\n",t+="</MusThGUI>"),t},n.XMLConverter.prototype.getKeyboardInputTextOutput=function(t){var n,o,i;for(n="",o=e.XML.parse(t).getElementsByTagName("selectedkey"),i=0;i<o.length;i++)n+=o[i].getAttribute("pitchclass")+"-"+o[i].getAttribute("register")+",";return n=n.length>0?n.substr(0,n.length-1):""},n.XMLConverter.prototype.getKeyboardInputXML=function(e){var t;if(t='<keyboardinput maxkeys="1" canvasEditable="'+this.options.editable+'">\n',t+="<givenkeys>\n","true"===this.options.includestaticnote&&(t+='<givenkey pitchclass="'+this.options.staticnotepitchclass+'" register="'+this.options.staticnoteregister+'" />'),t+="</givenkeys>\n",t+="<selectedkeys>\n",""!==e&&null!=e){var n=e.split("-");t+='<selectedkey pitchclass = "'+n[0]+'" register = "'+n[1]+'" />'}return t+="</selectedkeys>\n",t+="</keyboardinput>"},n.XMLConverter.prototype.getKSWriteTextOutput=function(t){var n,o="",i=e.XML.parse(t).getElementsByTagName("Accidental");for(n=0;n<i.length;n++)o+=i[n].getAttribute("letter")+i[n].getAttribute("type")+i[n].getAttribute("register")+",";return o=o.length>0?o.substr(0,o.length-1):""},n.XMLConverter.prototype.getKSWriteXML=function(e){var t,n,o;if(t='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',t+='<StaffSystem maxLedgerLines="0">\n',t+='<Staff clef="'+this.options.clef+'">\n',t+='<KeySign totalAccColumns="7">\n',null!==(n=""===e||null==e?null:e.split(",")))for(o=0;o<n.length;o++)t+='<Accidental type="'+n[o].substr(1,1)+'" letter="'+n[o].substr(0,1)+'" register="'+n[o].substr(2,1)+'" editable="'+this.setNotesEditable+'" />\n';return t+="</KeySign>\n",t+="</Staff>\n",t+="</StaffSystem>\n",t+="    <Toolbars>\n",t+="        <AccidentalToolbar>\n",t+='            <Button symbol="#"/>\n',t+='            <Button symbol="b"/>\n',t+="        </AccidentalToolbar>\n",t+="    </Toolbars>\n",t+="</MusThGUI>"},n.XMLConverter.prototype.getKSIdentifyXML=function(e){var t,n,o;if(t='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',t+='<StaffSystem maxLedgerLines="0">\n',t+='<Staff clef="'+this.options.clef+'">\n',t+='<KeySign totalAccColumns="7">\n',null!==(n=""===e||null==e?null:e.split(",")))for(o=0;o<n.length;o++)t+='<Accidental type="'+n[o].substr(1,1)+'" letter="'+n[o].substr(0,1)+'" register="'+n[o].substr(2,1)+'" editable="false" />\n';return t+="</KeySign>\n",t+="</Staff>\n",t+="</StaffSystem>\n",t+="    <Toolbars>\n",t+="        <AccidentalToolbar>\n",t+='            <Button symbol="#"/>\n',t+='            <Button symbol="b"/>\n',t+="        </AccidentalToolbar>\n",t+="    </Toolbars>\n",t+="</MusThGUI>"},n.XMLConverter.prototype.getScaleWriteTextOutput=function(t){var n,o,i="",s=e.XML.parse(t).getElementsByTagName("NoteColumn"),a=0;for(a=0;a<s.length;a++)null!=(n=s[a].getElementsByTagName("Note")[0])&&(o=n.getAttribute("accidental"),i+=n.getAttribute("letter")+o+n.getAttribute("register")),i+=",";for(;a<8;a++)i+=",";return i=i.substr(0,i.length-1)},n.XMLConverter.prototype.getScaleWriteXML=function(e){var t,o,i,s,a,r,l=this.options.givenNote.ltr+this.options.givenNote.acc;for("major"===this.options.scaleType||"pentatonic_major"===this.options.scaleType||"ionian"===this.options.scaleType||"dorian"===this.options.scaleType||"phrygian"===this.options.scaleType||"lydian"===this.options.scaleType||"mixolydian"===this.options.scaleType||"aeolian"===this.options.scaleType||"locrian"===this.options.scaleType||"chromatic"===this.options.scaleType?l+="M":l+="m",i=this.options.includeKS?new n.getKeySign(l,this.options.clef):[],s='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="'+this.options.includeKS+'">\n',s+='<StaffSystem maxLedgerLines="4">\n',s+='<Staff clef="'+this.options.clef+'">\n',s+='<KeySign totalAccColumns="'+i.length+'">\n',t=0;t<i.length;t++)s+='<Accidental type="'+(o=this.noteNameToParts(i[t])).acc+'" letter="'+o.ltr+'" register="'+o.reg+'" editable="false" />';if(s+="</KeySign>\n",s+="<NoteColumns>",null!==(a=""===e||null==e?null:e.split(",")))for(t=0;t<a.length;t++)""!==a[t]?(s+='<NoteColumn maxNotes="1" >',s+='<Note letter="'+(o=this.noteNameToParts(a[t])).ltr+'" ',s+='register="'+o.reg+'" ',s+='accidental="'+o.acc+'" ',s+=0===t?'noteValue="whole" editable="false" />':'noteValue="whole" editable="'+this.setNotesEditable+'" />',s+="</NoteColumn>"):s+='<NoteColumn maxNotes="1" />';else for(r="melodic"===this.options.scaleType?15:"chromatic"===this.options.scaleType?13:8,t=0;t<r;t++)0===t?(s+='<NoteColumn maxNotes="1">',s+='<Note letter="'+this.options.givenNote.ltr+'" ',s+='register="'+this.options.givenNote.reg+'" ',s+='accidental="'+this.options.givenNote.acc+'" ',s+='noteValue="whole" editable="false" />',s+="</NoteColumn>"):s+='<NoteColumn maxNotes="1" />';return s+="</NoteColumns>",s+="</Staff>\n",s+="</StaffSystem>\n",s+="    <Toolbars>\n",s+="        <AccidentalToolbar>\n",s+='            <Button symbol="n"/>',s+='            <Button symbol="#"/>',s+='            <Button symbol="b"/>',s+='            <Button symbol="x"/>',s+='            <Button symbol="bb"/>',s+="        </AccidentalToolbar>\n",s+="    </Toolbars>\n",s+="</MusThGUI>"},n.XMLConverter.prototype.getScaleIdentifyXML=function(e){var t,o,i,s,a,r,l=this.options.givenNote.ltr+this.options.givenNote.acc;for("major"===this.options.scaleType||"pentatonic_major"===this.options.scaleType||"ionian"===this.options.scaleType||"dorian"===this.options.scaleType||"phrygian"===this.options.scaleType||"lydian"===this.options.scaleType||"mixolydian"===this.options.scaleType||"aeolian"===this.options.scaleType||"locrian"===this.options.scaleType||"chromatic"===this.options.scaleType?l+="M":l+="m",console.log(this.options.scaleType),i=this.options.includeKS?new n.getKeySign(l,this.options.clef):[],s='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="'+this.options.includeKS+'">\n',s+='<StaffSystem maxLedgerLines="4">\n',s+='<Staff clef="'+this.options.clef+'">\n',s+='<KeySign totalAccColumns="'+i.length+'">\n',t=0;t<i.length;t++)s+='<Accidental type="'+(o=this.noteNameToParts(i[t])).acc+'" letter="'+o.ltr+'" register="'+o.reg+'" editable="false" />';if(s+="</KeySign>\n",s+="<NoteColumns>",null!==(a=""===e||null==e?null:e.split(",")))for(t=0;t<a.length;t++)""!==a[t]?(s+='<NoteColumn maxNotes="1" >',s+='<Note letter="'+(o=this.noteNameToParts(a[t])).ltr+'" ',s+='register="'+o.reg+'" ',s+='accidental="'+o.acc+'" ',s+='noteValue="whole" editable="false" />',s+="</NoteColumn>"):s+='<NoteColumn maxNotes="1" />';else for(r="melodic"===this.options.scaleType?15:"pentatonic_major"===this.options.scaleType?6:"pentatonic_minor"===this.options.scaleType?6:"blues"===this.options.scaleType?7:"chromatic"===this.options.scaleType?13:8,t=0;t<r;t++)0===t?(s+='<NoteColumn maxNotes="1">',s+='<Note letter="'+this.options.givenNote.ltr+'" ',s+='register="'+this.options.givenNote.reg+'" ',s+='accidental="'+this.options.givenNote.acc+'" ',s+='noteValue="whole" editable="false" />',s+="</NoteColumn>"):s+='<NoteColumn maxNotes="1" />';return s+="</NoteColumns>",s+="</Staff>\n",s+="</StaffSystem>\n",s+="</MusThGUI>"},n.XMLConverter.prototype.getIntervalWriteTextOutput=function(t){var n,o="",i=e.XML.parse(t).getElementsByTagName("Note"),s=0;for(s=0;s<i.length;s++)"true"===i[s].getAttribute("editable")&&(n=i[s].getAttribute("accidental"),o+=i[s].getAttribute("letter")+n+i[s].getAttribute("register")+",");return o=o.length>0?o.substr(0,o.length-1):""},n.XMLConverter.prototype.getIntervalWriteXML=function(e){var t,n;return t='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',t+='<StaffSystem maxLedgerLines="4">',t+='<Staff clef="'+this.options.clef+'">',t+='<KeySign totalAccColumns="0" >',t+="</KeySign>",t+="<NoteColumns>",t+='<NoteColumn maxNotes="2" >',t+='<Note letter="'+this.options.givenNote.ltr+'" ',t+='register="'+this.options.givenNote.reg+'" ',t+='accidental="'+this.options.givenNote.acc+'" ',t+='noteValue="whole" editable="false" />',""!==e&&null!=e&&(t+='<Note letter="'+(n=this.noteNameToParts(e)).ltr+'" ',t+='register="'+n.reg+'" ',t+='accidental="'+n.acc+'" ',t+='noteValue="whole" editable="'+this.setNotesEditable+'" />'),t+="</NoteColumn>",t+="</NoteColumns>",t+="</Staff>",t+="</StaffSystem>",t+="    <Toolbars>\n",t+="        <AccidentalToolbar>\n",t+='            <Button symbol="n"/>',t+='            <Button symbol="#"/>',t+='            <Button symbol="b"/>',t+='            <Button symbol="x"/>',t+='            <Button symbol="bb"/>',t+="        </AccidentalToolbar>\n",t+="    </Toolbars>\n",t+="</MusThGUI>"},n.XMLConverter.prototype.getIntervalIdentifyXML=function(e){var t,n;return t='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',t+='<StaffSystem maxLedgerLines="4">',t+='<Staff clef="'+this.options.clef+'">',t+='<KeySign totalAccColumns="0" >',t+="</KeySign>",t+="<NoteColumns>",t+='<NoteColumn maxNotes="2" >',t+='<Note letter="'+this.options.givenNote.ltr+'" ',t+='register="'+this.options.givenNote.reg+'" ',t+='accidental="'+this.options.givenNote.acc+'" ',t+='noteValue="whole" editable="false" />',""!==e&&null!=e&&(t+='<Note letter="'+(n=this.noteNameToParts(e)).ltr+'" ',t+='register="'+n.reg+'" ',t+='accidental="'+n.acc+'" ',t+='noteValue="whole" editable="false" />'),t+="</NoteColumn>",t+="</NoteColumns>",t+="</Staff>",t+="</StaffSystem>",t+="    <Toolbars>\n",t+="        <AccidentalToolbar>\n",t+='            <Button symbol="n"/>',t+='            <Button symbol="#"/>',t+='            <Button symbol="b"/>',t+='            <Button symbol="x"/>',t+='            <Button symbol="bb"/>',t+="        </AccidentalToolbar>\n",t+="    </Toolbars>\n",t+="</MusThGUI>"},n.XMLConverter.prototype.getChordQualityWriteXML=function(e){var t,n,o,i;if(o='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',o+='<StaffSystem maxLedgerLines="4">',o+='<Staff clef="'+this.options.clef+'">',o+='<KeySign totalAccColumns="0"></KeySign>\n',o+="<NoteColumns>",o+='<NoteColumn maxNotes="'+this.options.maxNotes+'" >',""!==e&&null!=e)for(i=e.split(","),n=0;n<i.length;n++)""!==i[n]&&(o+='<Note letter="'+(t=this.noteNameToParts(i[n])).ltr+'" ',o+='register="'+t.reg+'" ',o+='accidental="'+t.acc+'" ',o+='noteValue="whole" editable="'+this.setNotesEditable+'" />');return o+="</NoteColumn>",o+="</NoteColumns>",o+="</Staff>",o+="</StaffSystem>",o+="    <Toolbars>\n",o+="        <AccidentalToolbar>\n",o+='            <Button symbol="n"/>',o+='            <Button symbol="#"/>',o+='            <Button symbol="b"/>',o+='            <Button symbol="x"/>',o+='            <Button symbol="bb"/>',o+="        </AccidentalToolbar>\n",o+="    </Toolbars>\n",o+="</MusThGUI>"},n.XMLConverter.prototype.getHarmonicfunctionWriteTextOutput=function(t){var n,o,i,s="",a=e.XML.parse(t).getElementsByTagName("NoteColumn"),r=0,l=0;for(r=0;r<a.length;r++)for(l=(o=a[r].getElementsByTagName("Note")).length-1;l>=0;l--)null!=(n=o[l])&&(i=n.getAttribute("accidental"),s+=n.getAttribute("letter")+i+n.getAttribute("register")),s+=",";return s=s.substr(0,s.length-1)},n.XMLConverter.prototype.getHarmonicFunctionWriteXML=function(e){var t,o,i,s,a;for(s='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',s+='<StaffSystem maxLedgerLines="4">',s+='<Staff clef="'+this.options.clef+'">',s+='<KeySign totalAccColumns="'+(t=this.options.includeKS?new n.getKeySign(this.options.key,this.options.clef):[]).length+'">\n',i=0;i<t.length;i++)s+='<Accidental type="'+(o=this.noteNameToParts(t[i])).acc+'" letter="'+o.ltr+'" register="'+o.reg+'" editable="false" />';if(s+="</KeySign>\n",s+="<NoteColumns>",s+='<NoteColumn maxNotes="'+this.options.maxNotes+'" >',""!==e&&null!=e)for(a=e.split(","),i=0;i<a.length;i++)""!==a[i]&&(s+='<Note letter="'+(o=this.noteNameToParts(a[i])).ltr+'" ',s+='register="'+o.reg+'" ',s+='accidental="'+o.acc+'" ',s+='noteValue="whole" editable="'+this.setNotesEditable+'" />');return s+="</NoteColumn>",s+="</NoteColumns>",s+="</Staff>",s+="</StaffSystem>",s+="    <Toolbars>\n",s+="        <AccidentalToolbar>\n",s+='            <Button symbol="n"/>',s+='            <Button symbol="#"/>',s+='            <Button symbol="b"/>',s+='            <Button symbol="x"/>',s+='            <Button symbol="bb"/>',s+="        </AccidentalToolbar>\n",s+="    </Toolbars>\n",s+="</MusThGUI>"},n.XMLConverter.prototype.getHarmonicFunctionIdentifyXML=function(e){var t,o,i,s,a;for(s='<MusThGUI canvasEditable="'+this.options.editable+'" accidentalCarryOver="true">\n',s+='<StaffSystem maxLedgerLines="4">',s+='<Staff clef="'+this.options.clef+'">',s+='<KeySign totalAccColumns="'+(t=this.options.includeKS?new n.getKeySign(this.options.key,this.options.clef):[]).length+'">\n',i=0;i<t.length;i++)s+='<Accidental type="'+(o=this.noteNameToParts(t[i])).acc+'" letter="'+o.ltr+'" register="'+o.reg+'" editable="false" />';if(s+="</KeySign>\n",s+="<NoteColumns>",""!==e&&null!=e){for(s+='<NoteColumn maxNotes="'+(a=e.split(",")).length+'" >',i=0;i<a.length;i++)""!==a[i]&&(s+='<Note letter="'+(o=this.noteNameToParts(a[i])).ltr+'" ',s+='register="'+o.reg+'" ',s+='accidental="'+o.acc+'" ',s+='noteValue="whole" editable="false" />');s+="</NoteColumn>"}else s+='<NoteColumn maxNotes="0" />';return s+="</NoteColumns>",s+="</Staff>",s+="</StaffSystem>",s+="</MusThGUI>"},n.XMLConverter.prototype.noteNameToParts=function(e){var t,n=[];return t=e.search("-")<0?e.length:e.search("-"),n.ltr=e.substr(0,1),n.acc=e.substr(1,t-2),n.reg=e.substr(t-1,1),e.search("-")>=0?n.clef=e.substr(t+1):n.clef="",n}},"@VERSION@",{requires:["base","node","datatype","node-event-simulate"]});